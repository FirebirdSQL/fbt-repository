{
'id': 'bugs.core_2252',
'qmid': None,
'tracker_id': 'CORE-2252',
'title': 'EXECUTE STATEMENT on EXTERNAL SOURCE does not check the status of the transaction',
'description': '',
'min_versions': '',
'versions': [
{
 'firebird_version': '2.5.0',
 'platform': 'All',
 'page_size': '4096',
 'test_type': 'ISQL',
 'test_script':
  """
    -- ::: nb :::
    -- In new database 1st executable statement will work:
    -- within Tx = 4 for xClassic
    -- within Tx = 5 for SuperServer

    -- Additional (first) Tx = 4 in SuperServer does following:
    --    YYYY-MM-DDThh:mi:ss.zzzz (1200:018850F0) EXECUTE_STATEMENT_FINISH
    --            /path/file.fdb (ATT_2, SYSDBA:NONE, NONE, <internal>)
    --                    (TRA_4, CONCURRENCY | WAIT | READ_ONLY)
    --    
    --    Statement 9:
    --    -------------------------------------------------------------------------------
    --    SELECT
    --        RDB$MAP_USING, RDB$MAP_PLUGIN, RDB$MAP_DB, RDB$MAP_FROM_TYPE,
    --        RDB$MAP_FROM, RDB$MAP_TO_TYPE, RDB$MAP_TO
    --    FROM RDB$AUTH_MAPPING
    --    
    --    0 records fetched
    --          0 ms, 1 fetch(es)
    --    
    --    YYYY-MM-DDThh:mi:ss.zzzz (1200:018850F0) ROLLBACK_TRANSACTION
    --            /path/file.fdb (ATT_2, SYSDBA:NONE, NONE, <internal>)
    --                    (TRA_4, CONCURRENCY | WAIT | READ_ONLY)
    --          0 ms, 1 read(s), 1 write(s), 1 fetch(es), 1 mark(s)

    -- Because of this, output has been changed: instead of absolute Tx number we return only its SIGN.

    set list on;
    set term ^;
    execute block
    returns (tx_sign integer)
    as
        declare variable db_name type of column mon$attachments.mon$attachment_name;
    begin
        select a.mon$attachment_name from mon$attachments a
        where a.mon$attachment_id = current_connection
        into :db_name;
    
        execute statement 'select sign(current_transaction) from rdb$database'
        on external 'localhost:' || :db_name
        as user 'sysdba' password 'masterkey'
        into :tx_sign;
    
        suspend;
    end ^
    set term ; ^
  """,
 'expected_stdout':
  """
    TX_SIGN                         1
  """
}
]
}
