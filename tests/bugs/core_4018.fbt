{
'id': 'bugs.core_4018',
'qmid': None,
'tracker_id': 'CORE-4018',
'title': 'Using system domain in procedures arguments/returns cause the proc to be unchangeable',
'description': '',
'min_versions': '3.0',
'versions': [
{
 'firebird_version': '3.0',
 'platform': 'All',
 'init_script': 
  """
  """,
 'test_type': 'ISQL',
 'test_script': 
  """
    set list on;
    set blob all;
    set count on;

    set term ^;
    create procedure sp_test returns(info rdb$source) as
    begin
      info = 'foo';
      suspend;
    end
    ^
    set term ;^
    commit;
       
    select rdb$parameter_name, rdb$parameter_type, rdb$field_source
    from rdb$procedure_parameters 
    where rdb$procedure_name = upper('sp_test')
    order by rdb$parameter_number;

    select rdb$procedure_source 
    from rdb$procedures 
    where rdb$procedure_name = upper('sp_test');
    commit;

    set term ^;
    alter procedure sp_test(whoami rdb$user) returns(memo_info rdb$description) as
    begin
        memo_info = 'bar';
        suspend;
    end
    ^
    set term ;^
    commit;

    select rdb$parameter_name, rdb$parameter_type, rdb$field_source 
    from rdb$procedure_parameters 
    where rdb$procedure_name = upper('sp_test')
    order by rdb$parameter_number;

    select rdb$procedure_source 
    from rdb$procedures 
    where rdb$procedure_name = upper('sp_test');
    commit;

    drop procedure sp_test;
    commit;

    select rdb$parameter_name, rdb$parameter_type, rdb$field_source 
    from rdb$procedure_parameters 
    where rdb$procedure_name = upper('sp_test')
    order by rdb$parameter_number;

    select rdb$procedure_source 
    from rdb$procedures 
    where rdb$procedure_name = upper('sp_test');
    commit;

  """,
 'expected_stdout': 
  """
    RDB$PARAMETER_NAME              INFO
    RDB$PARAMETER_TYPE              1
    RDB$FIELD_SOURCE                RDB$SOURCE
    Records affected: 1
    RDB$PROCEDURE_SOURCE            1a:1e0
    begin
    info = 'foo';
    suspend;
    end
    Records affected: 1
    RDB$PARAMETER_NAME              MEMO_INFO
    RDB$PARAMETER_TYPE              1
    RDB$FIELD_SOURCE                RDB$DESCRIPTION
    RDB$PARAMETER_NAME              WHOAMI
    RDB$PARAMETER_TYPE              0
    RDB$FIELD_SOURCE                RDB$USER
    Records affected: 2
    RDB$PROCEDURE_SOURCE            1a:1e3
    begin
    memo_info = 'bar';
    suspend;
    end
    Records affected: 1
    Records affected: 0
    Records affected: 0
  """
}
]
}
