{
'id': 'bugs.core_3188',
'qmid': None,
'tracker_id': 'CORE-3188',
'title': 'page 0 is of wrong type (expected 6, found 1)',
'description': 
 """
   Confirmed on WI-V2.5.0.26074
     exception:
     DatabaseError:
     Error while commiting transaction:
     - SQLCODE: -902
     - database file appears corrupt (C:\MIX\FIREBIRD\QA\FBT-REPO\TMP\BUGS.CORE_3188.FDB)
     - wrong page type
     - page 0 is of wrong type (expected 6, found 1)
     -902
     335544335

   New messages in firebird.log in 2.5.0 after running ticket statements:

    CSPROG (Client)	Mon Feb 15 07:28:05 2016
        INET/inet_error: connect errno = 10061
    CSPROG	Mon Feb 15 07:41:02 2016
        Shutting down the server with 0 active connection(s) to 0 database(s), 1 active service(s)
 """,
'min_versions': '2.5.1',
'versions': [
{
 'firebird_version': '2.5',
 'platform': 'All',
 'test_type': 'Python',
 'test_script': 
  """
import os
import difflib

def svc_get_fb_log( engine, f_fb_log ):

  import subprocess

  # ::: NB ::: Service call for receive firebird.log works properly only since FB 2.5.2!

  if engine.startswith('2.5'):
      get_firebird_log_key='action_get_ib_log'
  else:
      get_firebird_log_key='action_get_fb_log'

  subprocess.call([ "fbsvcmgr",
                    "localhost:service_mgr",
                    "user", user_name, "password", user_password,
                    get_firebird_log_key
                  ],
                  stdout=f_fb_log, stderr=subprocess.STDOUT
                 )
  return


db_conn.close()
os.environ["ISC_USER"] = user_name
os.environ["ISC_PASSWORD"] = user_password

# Start two attachments:

con1 = kdb.connect(dsn=dsn)
con2 = kdb.connect(dsn=dsn)

# Session-1:

c1 = con1.cursor()

c1.execute("select rdb$get_context('SYSTEM','ENGINE_VERSION') as engine_version from rdb$database")
for row in c1:
    engine = row[0]


f_fblog_before=open( os.path.join(context['temp_directory'],'tmp_3188_fblog_before.txt'), 'w')
svc_get_fb_log( engine, f_fblog_before )
f_fblog_before.close()

c1.execute("create table test(id int primary key)")
con1.commit()

# Session-2:

c2 = con2.cursor()
c2.execute('drop table test')
con2.commit()

# cleanup
con1.close()
con2.close()

f_fblog_after=open( os.path.join(context['temp_directory'],'tmp_3188_fblog_after.txt'), 'w')
svc_get_fb_log( engine, f_fblog_after )
f_fblog_after.close()

# Now we can compare two versions of firebird.log and check their difference.

oldfb=open(f_fblog_before.name, 'r')
newfb=open(f_fblog_after.name, 'r')

difftext = ''.join(difflib.unified_diff(
    oldfb.readlines(), 
    newfb.readlines()
  ))
oldfb.close()
newfb.close()

f_diff_txt=open( os.path.join(context['temp_directory'],'tmp_3188_diff.txt'), 'w')
f_diff_txt.write(difftext)
f_diff_txt.close()

# Difference of firebird.log should be EMPTY:

with open( f_diff_txt.name,'r') as f:
    print( f.read() )
f.close()

###############################
# Cleanup.
f_list=[]
f_list.append(f_fblog_before)
f_list.append(f_fblog_after)
f_list.append(f_diff_txt)

for i in range(len(f_list)):
    if os.path.isfile(f_list[i].name):
        os.remove(f_list[i].name)
  """,
 'expected_stdout': 
  """
  """,
 'expected_stderr': 
  """
  """
}
]
}

