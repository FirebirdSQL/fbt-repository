{
'id': 'bugs.core_4707',
'qmid': None,
'tracker_id': 'CORE-4707',
'title': 'Implement ability to validate tables and indices online (without exclusive access to database)',
'description': '',
'min_versions': '2.5.5',
'versions': [
{
 'firebird_version': '2.5',
 'platform': 'All',
 'page_size': '4096',
 'init_script': 
  """
    set term ^;
    execute block as
    begin
        execute statement 'drop sequence g';
    when any do begin end
    end^
    set term ;^
    commit;
    create sequence g;
    commit;
    recreate table test1(id int, s varchar(1000));
    recreate table test2(id int primary key using index test2_pk, s varchar(1000), t computed by (s) );
    recreate table test3(id int);
    commit;
    
    insert into test1(id, s) select gen_id(g,1), rpad('', 1000, gen_id(g,0) ) from rdb$types rows 100;
    insert into test2(id, s) select id, s from test1;
    commit;
    
    create index test2_s on test2(s);
    create index test2_c on test2 computed by(s);
    create index test2_t on test2 computed by(t);
    commit;
  """,
 'test_type': 'Python',
 'test_script': '''c = db_conn.cursor()
c.execute("""delete from test1 rows 1""")
c.execute("""insert into test3 values(1)""")
runProgram('fbsvcmgr',['localhost:service_mgr','user','SYSDBA','password','masterkey','-z'])
runProgram('fbsvcmgr',['localhost:service_mgr','user','SYSDBA','password','masterkey','info_server_version','info_svr_db_info'])
runProgram('fbsvcmgr',['localhost:service_mgr','user','SYSDBA','password','masterkey','action_validate','dbname','$(DATABASE_LOCATION)bugs.core_4707.fdb'])
#runProgram('C:/MIX/firebird/fb25sS/bin/fbsvcmgr',['localhost:service_mgr','user','SYSDBA','password','masterkey','action_validate','dbname','$(DATABASE_LOCATION)bugs.core_4707.fdb','val_lock_timeout','1'])
''',
 'expected_stdout':
  """
  """,
 'expected_stderr':
  """
  """
}
]
}
