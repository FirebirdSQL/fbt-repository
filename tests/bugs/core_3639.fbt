{
'id': 'bugs.core_3639',
'qmid': '',
'tracker_id': 'CORE-3639',
'title': 'Allow the use of multiple WHEN MATCHED / NOT MATCHED clauses in MERGE, as per the SQL 2008 specification',
'description': '',
'min_versions': '3.0',
'versions': [
{
 'firebird_version': '3.0',
 'platform': 'All',
 'test_type': 'ISQL',
 'init_script':
  """
    recreate table ta(id int primary key, x int, y int);
    recreate table tb(id int primary key, x int, y int);
    commit;
    insert into ta(id, x, y) values(1, 100, 111);
    insert into ta(id, x, y) values(2, 200, 222);
    insert into ta(id, x, y) values(3, 300, 333);
    insert into ta(id, x, y) values(4, 400, 444);
    insert into ta(id, x, y) values(5, 500, 555);
   
    insert into tb(id, x, y) values(1, 10, 11);
    insert into tb(id, x, y) values(4, 40, 44);
    insert into tb(id, x, y) values(5, 50, 55);
    commit;
  """,
 'test_script': 
  """
    select * from tb;
    
    merge into tb t
    using ta s
    on s.id = t.id
    when matched and t.id < 2 then delete
    when matched then update set t.x = t.x + s.x, t.y = t.y - s.y 
    when not matched and s.x < 250 then insert values(-s.id, s.x, s.y)
    when not matched then insert values(s.id, s.x, s.y)
    ;
    select * from tb;
    rollback;
    
    merge into tb t
    using ta s
    on s.id = t.id
    when matched and t.id = 1 then delete returning tb.id, tb.x, tb.y
    -- doesn`t compile: when matched and t.id = 4 then update set t.x = t.x + s.x, t.y = t.y - s.y returning tb.id, tb.x, tb.y
    ;
    rollback;  
  """,
 'expected_stdout': 
  """
              ID            X            Y
    ============ ============ ============
               1           10           11
               4           40           44
               5           50           55
    
    
              ID            X            Y
    ============ ============ ============
               4          440         -400
               5          550         -500
              -2          200          222
               3          300          333
    
    
              ID            X            Y
    ============ ============ ============
               1           10           11
  """,
  'substitutions': [('=.*','')]
}
]
}
