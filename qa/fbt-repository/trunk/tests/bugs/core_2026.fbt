{
'id': 'bugs.core_2026',
'qmid': None,
'tracker_id': 'CORE-2026',
'title': 'Problem with a read-only marked database',
'description': '',
'min_versions': '',
'versions': [
{
 'firebird_version': '2.1.2',
 'platform': 'All',
 'database_character_set': 'ISO8859_1',
 'page_size': '4096',
 'init_script': """create table test (test integer default 0);
""",
 'test_type': 'Python',
 'test_script': '''db_conn.close()
runProgram('gfix',['-mode','read_only','-user',user_name,'-pas',user_password,dsn])

script = """select RDB$FIELD_NAME, rdb$default_source from rdb$relation_fields where rdb$default_source is not null;
"""
runProgram('isql',['-ch','iso8859_1','-user',user_name,'-pas',user_password,dsn],script)

#db_conn = kdb.connect(dsn=dsn,user=user_name,password=user_password,charset='iso8859_1')
#c = db_conn.cursor()
#c.execute("select RDB$FIELD_NAME, rdb$default_source from rdb$relation_fields where rdb$default_source is not null")
#printData(c)
#db_conn.close()
''',
 'expected_stdout': """
RDB$FIELD_NAME                  RDB$DEFAULT_SOURCE
=============================== ==================
TEST                                          0:3
==============================================================================
RDB$DEFAULT_SOURCE:
default 0
==============================================================================

"""
},
{
 'firebird_version': '2.5',
 'platform': 'All',
 'database': 'Existing',
 'database_name': 'core2026-ods11.fdb',
 'database_character_set': 'ISO8859_1',
 'connection_character_set': 'ISO8859_1',
 'page_size': '4096',
 'test_type': 'ISQL',
 'test_script':
  """
    set list on;
    set blob all;
    select RDB$FIELD_NAME, rdb$default_source 
    from rdb$relation_fields 
    where rdb$default_source is not null;
  """,
 'expected_stdout': 
  """
    RDB$FIELD_NAME                  TEST                                                                                         
    RDB$DEFAULT_SOURCE              5:884
    default 0
  """,
  'substitutions': [('RDB\$DEFAULT_SOURCE.*','')]
},
{
 'firebird_version': '3.0',
 'platform': 'All',
 'database': 'Existing',
 'database_name': 'core2026-ods12.fdb',
 'database_character_set': 'ISO8859_1',
 'connection_character_set': 'ISO8859_1',
 'page_size': '4096',
 'test_type': 'ISQL',
 'test_script':
  """
    set list on;
    set blob all;
    select RDB$FIELD_NAME, rdb$default_source 
    from rdb$relation_fields 
    where rdb$default_source is not null;
  """,
 'expected_stdout': 
  """
    RDB$FIELD_NAME                  TEST                                                                                         
    RDB$DEFAULT_SOURCE              5:d13
    default 0
  """,
  'substitutions': [('RDB\$DEFAULT_SOURCE.*','')]
}
]
}
