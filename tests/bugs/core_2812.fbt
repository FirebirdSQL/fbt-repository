{
'id': 'bugs.core_2812',
'qmid': None,
'tracker_id': 'CORE-2812',
'title': 'Prohibit any improper mixture of explicit and implicit joins',
'description': '',
'min_versions': '2.5.3',
'versions': [
{
 'firebird_version': '2.5.3',
 'platform': 'All',
 'page_size': '4096',
 'test_type': 'ISQL',
 'init_script':
  """
    -- sql.ru/forum/actualutils.aspx?action=gotomsg&tid=804601&msg=9751146
    recreate table t_left(id int);
    insert into t_left values(111);
    insert into t_left values(999);
    commit;
    
    recreate table t_right(id int, val int);
    insert into t_right values(111,0);
    insert into t_right values(999,123456789);
    commit;
    
    recreate table t_middle(id int);
    insert into t_middle values(1);
    commit;
  """,
 'test_script':
  """
    select
      'case-1' as msg
     ,L.id proc_a_id
     ,m.id mid_id
     ,R.id b_id, R.val
    from t_left L
    
    ,  -- ::: nb ::: this is >>> COMMA <<< instead of `cross join`
    
    t_middle m
    left join t_right R on L.id=R.id;
    
    select
      'case-2' as msg
      ,l.id a_id, m.id mid_id, r.id b_id, r.val
    from t_left l
    cross join 
    t_middle m
    left join t_right r on l.id=r.id;
  """,
 'expected_stdout': 
  """
MSG       PROC_A_ID       MID_ID         B_ID          VAL 
====== ============ ============ ============ ============ 

MSG            A_ID       MID_ID         B_ID          VAL 
====== ============ ============ ============ ============ 
case-2          111            1          111            0 
case-2          999            1          999    123456789 
  """,
 'expected_stderr': 
  """
Statement failed, SQLSTATE = 22000
no current record for fetch operation
  """
},
{
 'firebird_version': '3.0',
 'platform': 'All',
 'page_size': '4096',
 'test_type': 'ISQL',
 'init_script':
  """
    recreate table t_left(id int);
    insert into t_left values(111);
    insert into t_left values(999);
    commit;
    
    recreate table t_right(id int, val int);
    insert into t_right values(111,0);
    insert into t_right values(999,123456789);
    commit;
    
    recreate table t_middle(id int);
    insert into t_middle values(1);
    commit;

    -- one more sample (after discussion with Dmitry by e-mail, 02-apr-2015 19:34)
    recreate table t1(id int); 
    commit;
    insert into t1 values( 1 ); 
    commit;

  """,
 'test_script':
  """
    select
      'case-1' as msg
     ,L.id proc_a_id
     ,m.id mid_id
     ,R.id b_id, R.val
    from t_left L
    
    ,  -- ::: nb ::: this is >>> COMMA <<< instead of `cross join`
    
    t_middle m
    left join t_right R on L.id=R.id;
    
    select
      'case-2' as msg
      ,l.id a_id, m.id mid_id, r.id b_id, r.val
    from t_left l
    cross join 
    t_middle m
    left join t_right r on l.id=r.id;

    -- Added 02-apr-2015:
    select 'case-3' msg, a.id from t1 a, t1 b join t1 c on a.id=c.id where a.id=b.id; -- this FAILS on 3.0
    select 'case-4' msg, a.id from t1 b, t1 a join t1 c on a.id=c.id where a.id=b.id; -- this WORKS on 3.0

  """,
 'expected_stdout': 
  """
    MSG            A_ID       MID_ID         B_ID          VAL 
    ====== ============ ============ ============ ============
    case-2          111            1          111            0 
    case-2          999            1          999    123456789 

    MSG              ID
    ====== ============
    case-4            1
  """,
 'expected_stderr': 
  """
    Statement failed, SQLSTATE = 42S22
    Dynamic SQL Error
    -SQL error code = -206
    -Column unknown
    -L.ID
    -At line 11, column 35
    Statement failed, SQLSTATE = 42S22
    Dynamic SQL Error
    -SQL error code = -206
    -Column unknown
    -A.ID
    -At line 1, column 79
  """,
  'substitutions': [ ('=.*',''), ('-At line.*','') ]
}
]
}
